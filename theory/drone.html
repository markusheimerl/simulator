<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Drone Dynamics: A Comprehensive Simulation Study</title>
    <link rel="stylesheet" href="pubcss-ieee.css" />
    <style>
      .equation {
        text-align: center;
        margin: 10px;
      }
    </style>
    <script
      type="text/javascript"
      async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_CHTML"
    ></script>
  </head>

  <body>
    <header class="col-span">
      <h1 class="title counter-skip">
        Drone Dynamics: A Comprehensive Simulation Study
      </h1>
      <div class="authors">
        <div class="author">
          <div>Markus Heimerl</div>
          <div>Ratisbon Robotics</div>
          <div>Regensburg, Germany</div>
          <div>markusheimerl@ratisbonrobotics.com</div>
        </div>
      </div>
    </header>

    <div class="abstract">
      <p>
        <em>Abstract</em>—In this study, a comprehensive analysis of drone
        dynamics through two-dimensional (2D) and three-dimensional (3D)
        simulations is presented. The paper elaborates on simulation
        methodologies in 2D and 3D spaces, discussing the determination of key
        simulation parameters and experimental methodologies. Theoretical models
        are formulated, and empirical data are analyzed to enhance the
        understanding and prediction of drone behavior under various operational
        scenarios.
      </p>
      <p>
        <em>Keywords</em>—drone dynamics, 2D and 3D simulation, state vectors,
        aerodynamics, empirical modeling, thrust dynamics, rotational mechanics.
      </p>
    </div>

    <h1>Introduction</h1>
    <section>
      <p>
        This paper explores the simulation of drone dynamics in both 2D and 3D
        perspectives, emphasizing the importance of precise simulation for
        optimizing drone flight parameters including efficiency, agility, and
        stability. It proposes a comprehensive framework for simulating
        realistic drone behaviors and assessing the influence of design
        modifications and environmental factors on flight performance.
      </p>
    </section>

    <h1>Two-Dimensional Simulation</h1>
    <section>
      <h2>State Representation</h2>
      <p>
        A simulation is considered comprehensive if it can predict the drone's
        state \(X\) for subsequent discrete time intervals.
      </p>
      <div class="equation">
        \( X = [x, y, \phi, \dot{x}, \dot{y}, \dot{\phi}] \)
      </div>
      <p>
        Here, \(X\) encapsulates the drone's coordinates (\(x, y\)), rotational
        angle (\(\phi\)) about the x-axis, and their corresponding velocities
        (\(\dot{x}, \dot{y}, \dot{\phi}\)). The thrust forces (\(F_{1}\) and
        \(F_{2}\)) from the rotors, combined with environmental factors, result
        in the alteration of the state vector \(X\). The thrusts \(F_{1}\) and
        \(F_{2}\) are angled relative to the y-axis by \(\phi\).
      </p>
      <figure>
        <div style="border: 1px solid #000; margin-top: 6px; overflow: hidden">
          <img
            src="2d_drone.svg"
            alt="Two-dimensional drone"
            style="
              max-width: 100%;
              max-height: 100%;
              display: block;
              margin: auto;
            "
          />
        </div>
        <figcaption>
          Two-dimensional drone representation. Physical units are given in
          brackets.
        </figcaption>
      </figure>

      <h2>Dynamics Formulation</h2>
      <p>
        The dynamics of the drone are characterized by how its state \(X\)
        evolves under the influence of forces \(F_{1}\) and \(F_{2}\). These
        forces, as a function of rotor velocities (\(\omega_{1}, \omega_{2}\)),
        follow a quadratic relationship with thrust (denoted by \(k_{f}\)), a
        principle grounded in the laws of motion developed by Newton
        <a href="#newton1687">1</a>
        in the 17th century.
      </p>
      <div class="equation">\( F_{i} = k_{f} \omega_{i}^2 \)</div>
      <p>
        Changes in the drone's position (\(x, y, \phi\)) are derived from the
        integration of velocities (\(\dot{x}, \dot{y}, \dot{\phi}\)), which in
        turn stem from the integration of accelerations (\(\ddot{x}, \ddot{y},
        \ddot{\phi}\)). These accelerations are calculated using Newton's second
        law (\(F = ma\)) <a href="#newton1687">1</a> and the gravitational force
        (\(F_{g} = mg\)), with \(g\) being the gravitational constant \( 9.81
        \frac{m}{s^2} \).
      </p>
      <div class="equation">
        \[ -\ddot{y} = \frac{F_{g} - F_{y}}{m} = F_{y} - g \qquad \ddot{x} =
        \frac{F_{x}}{m} \]
      </div>
      <p>
        The thrust components \(F_{x}\) and \(F_{y}\), acting along the x-axis
        and y-axis respectively, are computed using trigonometric relationships
        derived from the total thrust force (\(F_{total} = F_1 + F_2\)) and the
        orientation angle (\(\phi\)).
      </p>
      <div class="equation">
        \[ F_{y} = F_{total} \cos{\phi} \qquad F_{x} = F_{total} \sin{\phi} \]
      </div>
      <figure>
        <div style="border: 1px solid #000; margin-top: 6px; overflow: hidden">
          <img
            src="2d_drone_forces.svg"
            alt="Forces on a 2D drone"
            style="
              max-width: 100%;
              max-height: 100%;
              display: block;
              margin: auto;
            "
          />
        </div>
        <figcaption>Forces acting on a two-dimensional drone.</figcaption>
      </figure>

      <p>
        In drone dynamics, we employ two torque formulas (\(M_{x}\)), each with
        distinct historical and physical foundations. The first, \(M_{x} =
        F_{\phi} L\), originates from Archimedes' concept of leverage
        <a href="#archimedes">3</a>, where \(F_{\phi} = F_{2} - F_{1}\)
        represents the force from the drone's rotors and \(L\) is the lever arm
        - the distance from the center of mass to the motors. This equation
        captures the rotational effect of force. The second, \(M_{x} = I_{x}
        \ddot{\phi}\), is grounded in Newton's laws of motion
        <a href="#newton1687">1</a>, linking torque (\(M_{x}\)) with the drone's
        moment of inertia (\(I_{x}\)) and angular acceleration
        (\(\ddot{\phi}\)). Together, these formulas allow us to determine the
        angular acceleration of the drone.
      </p>
      <div class="equation">
        \[ M_{x} = F_{\phi}L \\ I_{x} \ddot{\phi} = (F_{2} - F_{1})L \\
        \ddot{\phi} = \frac{(F_{2} - F_{1}) L}{I_{x}} \]
      </div>

      <p>
        The state of the drone at time \( t + \Delta t \) is determined by the
        sum of its current state \( X_t \) and the integral of the state's time
        derivative \( \dot{X} \) over the interval \( \Delta t \). This integral
        represents a precise calculation of the state change. However, for
        computational simplicity, we often use an approximation method developed
        by Leonhard Euler in the 18th century <a href="#euler1768">2</a>.
        Euler's method approximates the future state by assuming a constant rate
        of change (\( \dot{X}_t \)) over a small interval (\( \Delta t \approx
        0.01\)), simplifying the integral to a product of the rate of change and
        the time interval.
      </p>
      <div class="equation">
        \[ X_{t + \Delta t} = X_{t} + \int_{t}^{t+\Delta t} \dot{X}_{\tau} d\tau
        \approx X_t + \Delta t\dot{X}_t \]
      </div>

      <p>
        To thoroughly describe the time evolution of the drone's state, we
        substitude the explicit expressions for the accelerations \(\ddot{x}\),
        \(\ddot{y}\), and \(\ddot{\phi}\) into the equation for \( X_{t + \Delta
        t} \). These accelerations are directly derived from the drone's
        dynamics, which include the influence of forces and torques resulting
        from the rotor thrusts and earth's gravity.
      </p>
      <div class="equation">
        \( X_{t + \Delta t} \approx X_t + \Delta t \dot{X}_t= \begin{bmatrix} x
        \\ y \\ \phi \\ \dot{x} \\ \dot{y} \\ \dot{\phi} \end{bmatrix}_t +
        \Delta t \begin{bmatrix} \dot{x} \\ \dot{y} \\ \dot{\phi} \\ \ddot{x} \\
        \ddot{y} \\ \ddot{\phi} \end{bmatrix}_t = \begin{bmatrix} x \\ y \\ \phi
        \\ \dot{x} \\ \dot{y} \\ \dot{\phi} \end{bmatrix}_t + \begin{bmatrix}
        \Delta t\dot{x} \\ \Delta t\dot{y} \\ \Delta t\dot{\phi} \\ \frac{\Delta
        t\sin{\phi}(F_1 + F_2)}{m} \\ \Delta t(g - \cos{\phi}(F_1 + F_2)) \\
        \frac{\Delta tL(F_{2} - F_{1})}{I_{x}} \end{bmatrix}_t \)
      </div>
    </section>

    <h1>Three-Dimensional Simulation</h1>
    <section>
      <h2>State</h2>
      <p>
        In the three-dimensional case, the state vector \(X\) consists of twelve
        quantities and is formally defined as
      </p>
      <div class="equation">
        \( X = [x, y, z, \phi, \theta, \psi, \dot{x}, \dot{y}, \dot{z}, p, q, r]
        \)
      </div>
      <p>where</p>
      <ul>
        <li>\(x, y, z\) represent positions,</li>
        <li>
          \(\dot{x}, \dot{y}, \dot{z}\) represent velocities in their respective
          axes,
        </li>
        <li>
          \(\phi, \theta, \psi\), also known as Euler angles, represent
          rotations about the x-axis, y-axis, and z-axis, and
        </li>
        <li>
          \(p, q, r\) are the angular velocities about the axes \(kx\), \(ky\),
          and \(kz\) in the body coordinate system.
        </li>
      </ul>
      <p>
        Except for the last three parameters, all information resides in the
        world coordinate system, which was the only one used in the
        two-dimensional case from Chapter
        <a href="#chapter-Simulation-TwoDimensional"
          >Two-Dimensional Simulation</a
        >. The body coordinate system, however, is a fixed coordinate system
        attached to the quadrotor.
      </p>
      <figure>
        <div style="border: 1px solid #000; margin-top: 6px; overflow: hidden">
          <img
            src="3d_drone_coordinate_system.png"
            alt="World and body coordinate systems"
            style="
              max-width: 30%;
              max-height: 30%;
              display: block;
              margin: auto;
            "
          />
        </div>
        <figcaption>World and body coordinate systems</figcaption>
      </figure>

      <h2>Dynamics</h2>
      <p>
        Equation (2) still applies here as before. Analogous to Equation 10, in
        the three-dimensional case, we also require the derivative \(\dot{X}\)
        of the state vector to move the state forward in time. Equations (3)
        still apply but now, analogous to \(\ddot{y}\), we add the formula for
        \(\ddot{x}\). In summary, still derived from Newton's \(F = ma\), we
        have
      </p>
      <div class="equation">
        \[ \ddot{z} = \frac{F_{g} - F_{z}}{m} = g - F_{z} \qquad \ddot{y} =
        \frac{F_{y}}{m} \qquad \ddot{x} = \frac{F_{x}}{m} \]
      </div>
      <p>
        Different from the two-dimensional case, however, are the formulas for
        \(F_{x}\), \(F_{y}\), and \(F_{z}\). Here a rotation matrix is defined,
        which transforms any vector from the body coordinate system into a
        vector in the world coordinate system through multiplication.
        Essentially, the matrix is still based on triangle trigonometry. The
        matrix \(R_{Body}^{World}\) is
      </p>
      <div class="equation">
        \begin{align*} R_{Body}^{World} &= \left[ \begin{array}{ccc} 1 & 0 & 0
        \\ 0 & \cos(\phi) & -\sin(\phi) \\ 0 & \sin(\phi) & \cos(\phi) \\
        \end{array} \right] \left[ \begin{array}{ccc} \cos(\theta) & 0 &
        \sin(\theta) \\ 0 & 1 & 0 \\ -\sin(\theta) & 0 & \cos(\theta) \\
        \end{array} \right] \left[ \begin{array}{ccc} \cos(\psi) & -\sin(\psi) &
        0 \\ \sin(\psi) & \cos(\psi) & 0 \\ 0 & 0 & 1 \\ \end{array} \right] \\
        &= \left[ \begin{array}{ccc} c(\psi)c(\theta) & c(\psi)s(\theta)s(\phi)
        - s(\psi)c(\phi) & s(\psi)s(\phi) + c(\psi)s(\theta)c(\phi) \\
        s(\psi)c(\theta) & c(\psi)c(\phi) + s(\psi)s(\theta)s(\phi) &
        s(\psi)s(\theta)c(\phi) - c(\psi)s(\phi) \\ -s(\theta) &
        c(\theta)s(\phi) & c(\theta)c(\phi) \end{array} \right] \end{align*}
      </div>
      <p>
        So, from Equations (22) and (23), we derive the formulas for axis
        accelerations in the world coordinate system as
      </p>
      <div class="equation">
        \[ \begin{bmatrix} \ddot{x} \\ \ddot{y} \\ \ddot{z} \end{bmatrix} =
        \left[ \begin{array}{c} 0 \\ 0 \\ g \end{array} \right] + \frac{1}{m}\:
        R_{Body}^{World} \left[ \begin{array}{c} 0 \\ 0 \\ -F_{total}
        \end{array} \right] = \left[ \begin{array}{c}
        R_{13}\frac{1}{m}(-F_{total}) \\ R_{23}\frac{1}{m}(-F_{total}) \\ g +
        R_{33}\frac{1}{m}(-F_{total}) \end{array} \right] \]
      </div>
      <p>
        Here it is also shown that the propellers generate thrust in the
        direction \(-kz\). On Earth, \(g = 9.81 \frac{m}{s^2}\). And the total
        force now results from the sum of all four rotors, so that
      </p>
      <div class="equation">
        \( F_{total} = \sum_{1}^{i} F_{i} = F_{1} + F_{2} + F_{3} + F_{4} \)
      </div>
      <figure>
        <div style="border: 1px solid #000; margin-top: 6px; overflow: hidden">
          <img
            src="3d_drone_from_above.png"
            alt="3D Drone from above: Propeller rotation directions and numbers. \(kz\) goes into the plane of the drawing."
            style="
              max-width: 30%;
              max-height: 30%;
              display: block;
              margin: auto;
            "
          />
        </div>
        <figcaption>
          3D Drone from above: Propeller rotation directions and numbers. \(kz\)
          goes into the plane of the drawing.
        </figcaption>
      </figure>
      <p>
        The accelerations around the body axes \(\dot{p}\), \(\dot{q}\), and
        \(\dot{r}\) are calculated by the Euler's equation of motion, which is
      </p>
      <div class="equation">
        \[ M = I\dot{\omega} + \omega \times (I\omega) = \begin{bmatrix} M_{x}
        \\ M_{y} \\ M_{z} \end{bmatrix} = \begin{bmatrix} I_{x} & 0 & 0 \\ 0 &
        I_{y} & 0 \\ 0 & 0 & I_{z} \end{bmatrix} \begin{bmatrix} \dot{p} \\
        \dot{q} \\ \dot{r} \end{bmatrix} + \begin{bmatrix} p \\ q \\ r
        \end{bmatrix} \times \left( \begin{bmatrix} I_{x} & 0 & 0 \\ 0 & I_{y} &
        0 \\ 0 & 0 & I_{z} \end{bmatrix} \begin{bmatrix} p \\ q \\ r
        \end{bmatrix} \right) \]
      </div>
      <p>
        The moments of inertia \(I_{x}\), \(I_{y}\), and \(I_{z}\) are
        determined by experiments, as explained in Chapter
        <a href="#chapter-SimulationParameterDetermination"
          >Simulation Parameter Determination</a
        >. By rearranging, we then get the accelerations as
      </p>
      <div class="equation">
        \[ \begin{bmatrix} \dot{p} \\ \dot{q} \\ \dot{r} \end{bmatrix} =
        \begin{bmatrix} \frac{M_{x} - rq(I_{x} - I_{y})}{I_{x}} \\ \frac{M_{y} -
        rp(I_{x} - I_{z})}{I_{y}} \\ \frac{M_{z} - pq(I_{y} - I_{x})}{I_{z}}
        \end{bmatrix} \]
      </div>

      <p>
        As remaining necessary quantities to establish \(\dot{X}\), which is the
        goal in dynamics, we have the velocities about the world coordinate
        system axes \(\dot{\phi}\), \(\dot{\theta}\), and \(\dot{\psi}\). These
        are obtained, like the linear accelerations in Equation \ref{eq:24} with
        the help of a rotation matrix specifically for Euler angle velocities.
      </p>
      <div class="equation">
        \[ \begin{bmatrix} \dot{\phi} \\ \dot{\theta} \\ \dot{\psi}
        \end{bmatrix} = \begin{bmatrix} 1 & \sin(\phi)\tan(\theta) &
        \cos(\phi)\tan(\theta) \\ 0 & \cos(\phi) & -\sin(\phi) \\ 0 &
        \sin(\phi)/\cos(\theta) & \cos(\phi)/\cos(\theta) \end{bmatrix}
        \begin{bmatrix} p \\ q \\ r \end{bmatrix} \]
      </div>

      <p>
        Thus, the state of the quadrotor at time \(t\) can be determined by the
        sum of the state \(X(t)\) and the integral of the state's derivative
        \(\dot{X}\).
      </p>
      <div class="equation">
        \[ X(t + \Delta t) = X(t) + \int_{t}^{t+\Delta t}\dot{X}(\tau) d\tau \]
      </div>
    </section>

    <h5 class="references">References</h5>
    <div class="references">
      <cite id="newton1687">
        Newton, I. (1687). Philosophiæ Naturalis Principia Mathematica
      </cite>
      <cite id="euler1768">
        Euler, L. (1768-1772). Institutiones calculi integralis
      </cite>
      <cite id="archimedes">
        Archimedes (ca. 250 BC). Περὶ ἐπιπέδων ἰσορροπιῶν
      </cite>
    </div>
  </body>
</html>
